<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Count-Up Timer</title>
</head>
<body>
  <h1>Count-Up Timer</h1>
  <p id="timer">0d 0h 0m 0s</p>
  <button id="startButton">Start Timer</button>

  <script>
    const button = document.getElementById('startButton');
    const timerDisplay = document.getElementById('timer');

    async function fetchStartTime() {
      try {
        const response = await fetch('/getStartTime');
        const data = await response.json();
        if (data.startTime) {
          updateTimer(data.startTime);
          button.disabled = true;
        }
      } catch (error) {
        console.error('Failed to fetch start time:', error);
      }
    }

    async function startTimer() {
      try {
        const response = await fetch('/startTimer', { method: 'POST' });
        if (response.ok) {
          const startTime = Date.now();
          updateTimer(startTime);
          button.disabled = true;
        } else {
          const error = await response.text();
          console.error('Failed to start timer:', error);
          alert(`Error: ${error}`);
        }
      } catch (error) {
        console.error('Failed to start timer:', error);
      }
    }

    function updateTimer(startTime) {
      const interval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const days = Math.floor(elapsed / (1000 * 60 * 60 * 24));
        const hours = Math.floor((elapsed / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((elapsed / (1000 * 60)) % 60);
        const seconds = Math.floor((elapsed / 1000) % 60);
        timerDisplay.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      }, 1000);
    }

    button.addEventListener('click', startTimer);

    // Fetch the timer start time on load
    fetchStartTime();
  </script>
</body>
</html>
